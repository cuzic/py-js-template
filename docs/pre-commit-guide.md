# ğŸ”§ Pre-commit ãƒ•ãƒƒã‚¯è¨­å®šã‚¬ã‚¤ãƒ‰

ã“ã®ã‚¬ã‚¤ãƒ‰ã§ã¯ã€ãƒãƒ¼ãƒ å…¨ä½“ã§ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¹ã‚¿ã‚¤ãƒ«ã‚’çµ±ä¸€ã™ã‚‹ãŸã‚ã®pre-commitãƒ•ãƒƒã‚¯è¨­å®šã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚

## ğŸ¯ æ¦‚è¦

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€ã‚³ãƒŸãƒƒãƒˆå‰ã«è‡ªå‹•çš„ã«ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒ†ã‚£ãƒ³ã‚°ã¨å“è³ªãƒã‚§ãƒƒã‚¯ã‚’è¡Œã†pre-commitãƒ•ãƒƒã‚¯ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ãƒãƒ¼ãƒ å…¨ä½“ã§ä¸€è²«ã—ãŸã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ç¶­æŒã§ãã¾ã™ã€‚

### âœ¨ ä¸»ãªæ©Ÿèƒ½

- **è‡ªå‹•ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒ†ã‚£ãƒ³ã‚°**: ã‚³ãƒŸãƒƒãƒˆå‰ã«ã‚³ãƒ¼ãƒ‰ãŒè‡ªå‹•çš„ã«ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã•ã‚Œã‚‹
- **å“è³ªãƒã‚§ãƒƒã‚¯**: ãƒªãƒ³ãƒ†ã‚£ãƒ³ã‚°ã€å‹ãƒã‚§ãƒƒã‚¯ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ¤œæŸ»ãŒè‡ªå‹•å®Ÿè¡Œ
- **å¤šè¨€èªå¯¾å¿œ**: Pythonã€JavaScript/TypeScriptã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’åŒ…æ‹¬çš„ã«ã‚µãƒãƒ¼ãƒˆ
- **è‡ªå‹•ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°**: ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå¾Œã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒè‡ªå‹•çš„ã«ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã•ã‚Œã‚‹

## ğŸ› ï¸ è¨­å®šå†…å®¹

### Python ãƒ•ãƒƒã‚¯

| ãƒ•ãƒƒã‚¯ | èª¬æ˜ | è‡ªå‹•ä¿®æ­£ |
|--------|------|----------|
| **Ruff** | é«˜é€Ÿãƒªãƒ³ãƒ†ã‚£ãƒ³ã‚°ï¼†ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒ†ã‚£ãƒ³ã‚° | âœ… |
| **Black** | ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒ†ã‚£ãƒ³ã‚°ï¼ˆfallbackï¼‰ | âœ… |
| **MyPy** | é™çš„å‹ãƒã‚§ãƒƒã‚¯ | âŒ |
| **Bandit** | ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ¤œæŸ» | âŒ |

### JavaScript/TypeScript ãƒ•ãƒƒã‚¯

| ãƒ•ãƒƒã‚¯ | èª¬æ˜ | è‡ªå‹•ä¿®æ­£ |
|--------|------|----------|
| **Prettier** | ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒ†ã‚£ãƒ³ã‚° | âœ… |
| **ESLint** | ãƒªãƒ³ãƒ†ã‚£ãƒ³ã‚°ã¨æœ€é©åŒ– | âœ… |

### ä¸€èˆ¬çš„ãªãƒ•ãƒƒã‚¯

| ãƒ•ãƒƒã‚¯ | èª¬æ˜ | è‡ªå‹•ä¿®æ­£ |
|--------|------|----------|
| **trailing-whitespace** | è¡Œæœ«ç©ºç™½ã®å‰Šé™¤ | âœ… |
| **end-of-file-fixer** | ãƒ•ã‚¡ã‚¤ãƒ«æœ«å°¾æ”¹è¡Œã®ä¿®æ­£ | âœ… |
| **check-yaml/json/toml** | è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®æ§‹æ–‡ãƒã‚§ãƒƒã‚¯ | âŒ |
| **conventional-pre-commit** | ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å½¢å¼ãƒã‚§ãƒƒã‚¯ | âŒ |

## ğŸš€ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### 1. åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

```bash
# mise ã§ãƒ„ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
mise install

# pre-commit ãƒ•ãƒƒã‚¯ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
mise exec -- pre-commit install
mise exec -- pre-commit install --hook-type commit-msg

# åˆå›å®Ÿè¡Œï¼ˆã™ã¹ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«é©ç”¨ï¼‰
mise exec -- pre-commit run --all-files
```

### 2. è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®pre-commitè¨­å®šã¯ `.pre-commit-config.yaml` ã§ç®¡ç†ã•ã‚Œã¦ã„ã¾ã™ï¼š

```yaml
repos:
  # åŸºæœ¬çš„ãªGitãƒ•ãƒƒã‚¯
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v5.0.0
    hooks:
      - id: trailing-whitespace
      - id: end-of-file-fixer
      - id: check-yaml
      # ... ãã®ä»–

  # Python ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒ†ã‚£ãƒ³ã‚°ï¼ˆRuffï¼‰
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.12.1
    hooks:
      - id: ruff
        args: [--fix, --exit-non-zero-on-fix]
      - id: ruff-format

  # JavaScript/TypeScript ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒ†ã‚£ãƒ³ã‚°
  - repo: https://github.com/pre-commit/mirrors-prettier
    rev: v4.0.0-alpha.8
    hooks:
      - id: prettier
        additional_dependencies:
          - prettier@3.6.2
```

## ğŸ’» ä½¿ç”¨æ–¹æ³•

### é€šå¸¸ã®ã‚³ãƒŸãƒƒãƒˆ

```bash
# ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†
vim backend/src/main.py
vim frontend/src/App.tsx

# å¤‰æ›´ã‚’ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°
git add .

# ã‚³ãƒŸãƒƒãƒˆï¼ˆpre-commitãƒ•ãƒƒã‚¯ãŒè‡ªå‹•å®Ÿè¡Œã•ã‚Œã‚‹ï¼‰
git commit -m "feat: æ–°æ©Ÿèƒ½ã‚’è¿½åŠ "
```

### ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãŒé©ç”¨ã•ã‚ŒãŸå ´åˆ

ã‚³ãƒŸãƒƒãƒˆæ™‚ã«ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãƒ¼ãŒãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¤‰æ›´ã—ãŸå ´åˆï¼š

```bash
$ git commit -m "feat: æ–°æ©Ÿèƒ½ã‚’è¿½åŠ "
ruff-format..............................................................Passed
prettier.................................................................Failed
- hook id: prettier
- files were modified by this hook

ğŸ“„ å¤‰æ›´ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«:
frontend/src/App.tsx

ğŸ“¦ å¤‰æ›´ã‚’ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã«è¿½åŠ ä¸­...
âœ… ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ¸ˆã¿ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã•ã‚Œã¾ã—ãŸã€‚å†åº¦ã‚³ãƒŸãƒƒãƒˆã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚

# ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ¸ˆã¿ãƒ•ã‚¡ã‚¤ãƒ«ãŒè‡ªå‹•ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã•ã‚ŒãŸã®ã§ã€å†ã‚³ãƒŸãƒƒãƒˆ
$ git commit -m "feat: æ–°æ©Ÿèƒ½ã‚’è¿½åŠ "
```

### æ‰‹å‹•å®Ÿè¡Œ

ç‰¹å®šã®ãƒ•ãƒƒã‚¯ã‚’æ‰‹å‹•ã§å®Ÿè¡Œã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ï¼š

```bash
# ã™ã¹ã¦ã®ãƒ•ãƒƒã‚¯ã‚’å®Ÿè¡Œ
mise exec -- pre-commit run --all-files

# ç‰¹å®šã®ãƒ•ãƒƒã‚¯ã‚’å®Ÿè¡Œ
mise exec -- pre-commit run ruff-format
mise exec -- pre-commit run prettier

# ç‰¹å®šã®ãƒ•ã‚¡ã‚¤ãƒ«ã«å¯¾ã—ã¦å®Ÿè¡Œ
mise exec -- pre-commit run --files backend/src/main.py
```

## ğŸ”§ ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

### é™¤å¤–ãƒ‘ã‚¿ãƒ¼ãƒ³ã®è¿½åŠ 

ç‰¹å®šã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’é™¤å¤–ã—ãŸã„å ´åˆï¼š

```yaml
# .pre-commit-config.yaml
exclude: |
  (?x)^(
    .*\.min\.(js|css)$|
    .*\.map$|
    your_custom_exclude_pattern.*
  )$
```

### æ–°ã—ã„ãƒ•ãƒƒã‚¯ã®è¿½åŠ 

æ–°ã—ã„ãƒ•ãƒƒã‚¯ã‚’è¿½åŠ ã™ã‚‹å ´åˆï¼š

```yaml
repos:
  - repo: https://github.com/your-organization/custom-hook
    rev: v1.0.0
    hooks:
      - id: custom-check
        name: Custom Check
        description: "ã‚«ã‚¹ã‚¿ãƒ ãƒã‚§ãƒƒã‚¯"
        files: ^your_pattern.*$
```

## ğŸ›¡ï¸ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

### Bandit ã«ã‚ˆã‚‹ Python ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯

```bash
# ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è„†å¼±æ€§ã‚’ãƒã‚§ãƒƒã‚¯
mise exec -- pre-commit run bandit-security

# ç‰¹å®šã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒã‚§ãƒƒã‚¯
mise exec -- bandit -r backend/src/
```

### é™¤å¤–è¨­å®š

false positiveã‚’é¿ã‘ã‚‹ãŸã‚ã€ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ãªã©ã¯é™¤å¤–ã•ã‚Œã¦ã„ã¾ã™ï¼š

```yaml
- id: bandit
  files: ^backend/src/.*\.py$
  exclude: ^backend/tests/
```

## ğŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹

### ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½

pre-commitã¯ç’°å¢ƒã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã™ã‚‹ãŸã‚ã€2å›ç›®ä»¥é™ã®å®Ÿè¡Œã¯é«˜é€Ÿã§ã™ï¼š

```bash
# ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢ï¼ˆå¿…è¦ãªå ´åˆã®ã¿ï¼‰
mise exec -- pre-commit clean

# ç’°å¢ƒã‚’å†æ§‹ç¯‰
mise exec -- pre-commit install-hooks
```

### ä¸¦åˆ—å®Ÿè¡Œ

è¤‡æ•°ã®ãƒ•ãƒƒã‚¯ãŒä¸¦åˆ—å®Ÿè¡Œã•ã‚Œã‚‹ãŸã‚ã€åŠ¹ç‡çš„ã§ã™ã€‚

## ğŸ› ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### å•é¡Œ1: ãƒ•ãƒƒã‚¯ãŒå®Ÿè¡Œã•ã‚Œãªã„

```bash
# ãƒ•ãƒƒã‚¯ãŒæ­£ã—ãã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
ls -la .git/hooks/

# å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
mise exec -- pre-commit uninstall
mise exec -- pre-commit install
```

### å•é¡Œ2: ç‰¹å®šã®ãƒ•ãƒƒã‚¯ã§ã‚¨ãƒ©ãƒ¼

```bash
# è©³ç´°ãƒ­ã‚°ã§å®Ÿè¡Œ
mise exec -- pre-commit run --verbose

# ç‰¹å®šã®ãƒ•ãƒƒã‚¯ã‚’ã‚¹ã‚­ãƒƒãƒ—
SKIP=mypy git commit -m "commit message"
```

### å•é¡Œ3: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒé…ã„

```bash
# ä¸¦åˆ—å®Ÿè¡Œæ•°ã‚’èª¿æ•´
mise exec -- pre-commit run --show-diff-on-failure

# ç‰¹å®šã®ãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿å®Ÿè¡Œ
mise exec -- pre-commit run --files changed_file.py
```

## ğŸ”„ CI/CD çµ±åˆ

GitHub Actions ã§ã‚‚åŒã˜ãƒ•ãƒƒã‚¯ãŒå®Ÿè¡Œã•ã‚Œã¾ã™ï¼š

```yaml
# .github/workflows/pre-commit.yml
- name: Run pre-commit
  uses: pre-commit/action@v3.0.0
```

## ğŸ“š å‚è€ƒãƒªãƒ³ã‚¯

- [pre-commit å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://pre-commit.com/)
- [Ruff è¨­å®šã‚¬ã‚¤ãƒ‰](https://docs.astral.sh/ruff/)
- [Prettier è¨­å®šã‚¬ã‚¤ãƒ‰](https://prettier.io/docs/en/configuration.html)
- [Conventional Commits](https://www.conventionalcommits.org/)

---

ğŸ’¡ **Pro Tip**: ãƒãƒ¼ãƒ å…¨ä½“ã§åŒã˜é–‹ç™ºç’°å¢ƒã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ã€DevContainer + mise ã®çµ„ã¿åˆã‚ã›ã‚’æ¨å¥¨ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€å…¨å“¡ãŒåŒã˜ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦pre-commitãƒ•ãƒƒã‚¯ã‚’å®Ÿè¡Œã§ãã¾ã™ã€‚