# ğŸ Python é–‹ç™ºã‚¬ã‚¤ãƒ‰

ã“ã®ã‚¬ã‚¤ãƒ‰ã§ã¯ã€Pythonãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰é–‹ç™ºã«ãŠã‘ã‚‹å“è³ªåŸºæº–ã€ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ«ãƒ¼ãƒ«ã€ãƒ†ã‚¹ãƒˆæˆ¦ç•¥ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚

## ğŸ“¦ æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

- **ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼**: [uv](https://github.com/astral-sh/uv) - è¶…é«˜é€ŸPythonãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼
- **ãƒ“ãƒ«ãƒ‰ã‚·ã‚¹ãƒ†ãƒ **: [Hatchling](https://hatch.pypa.io/) - ãƒ¢ãƒ€ãƒ³ãªPythonãƒ“ãƒ«ãƒ‰ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
- **ãƒªãƒ³ã‚¿ãƒ¼**: [Ruff](https://github.com/astral-sh/ruff) - Rustè£½è¶…é«˜é€Ÿãƒªãƒ³ã‚¿ãƒ¼
- **ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãƒ¼**: [Black](https://github.com/psf/black) - å¦¥å”ã®ãªã„ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãƒ¼
- **ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**: [pytest](https://docs.pytest.org/) - æŸ”è»Ÿã§å¼·åŠ›ãªãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯

## ğŸ—ï¸ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

```
backend/
â”œâ”€â”€ src/
â”‚   â””â”€â”€ backend/          # ãƒ¡ã‚¤ãƒ³ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
â”‚       â”œâ”€â”€ __init__.py
â”‚       â””â”€â”€ main.py
â”œâ”€â”€ tests/                # ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ test_main.py
â”œâ”€â”€ pyproject.toml        # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®š
â””â”€â”€ .gitignore
```

### src layout ã®æ¡ç”¨ç†ç”±

- **import ã®æ˜ç¢ºåŒ–**: ãƒ†ã‚¹ãƒˆæ™‚ã¨å®Ÿè¡Œæ™‚ã®importãŒä¸€è‡´
- **ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ³ã‚°**: ã‚ˆã‚Šè‰¯ã„wheelç”Ÿæˆã¨ãƒ‡ã‚£ã‚¹ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³
- **åå‰ç©ºé–“**: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã¨ã®è¡çªã‚’å›é¿

## ğŸ”§ ç’°å¢ƒè¨­å®š

### åˆæœŸã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

```bash
cd backend

# ä»®æƒ³ç’°å¢ƒä½œæˆ
uv venv

# ä»®æƒ³ç’°å¢ƒã®æœ‰åŠ¹åŒ–
source .venv/bin/activate  # Linux/macOS
# ã¾ãŸã¯
.venv\Scripts\activate     # Windows

# é–‹ç™ºä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
uv pip install -e ".[dev]"
```

### é–‹ç™ºç”¨ã‚³ãƒãƒ³ãƒ‰

```bash
# ãƒªãƒ³ãƒ†ã‚£ãƒ³ã‚°
ruff check .

# è‡ªå‹•ä¿®æ­£
ruff check --fix .

# ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
black .

# ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒã‚§ãƒƒã‚¯
black --check .

# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
pytest

# ã‚«ãƒãƒ¬ãƒƒã‚¸ä»˜ããƒ†ã‚¹ãƒˆ
pytest --cov=backend --cov-report=html
```

## ğŸ“ ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ«ãƒ¼ãƒ«

### 1. åŸºæœ¬æ–¹é‡

- **PEP 8**: Pythonã®æ¨™æº–ã‚¹ã‚¿ã‚¤ãƒ«ã‚¬ã‚¤ãƒ‰ã«æº–æ‹ 
- **å‹ãƒ’ãƒ³ãƒˆ**: é–¢æ•°ã®å¼•æ•°ã¨æˆ»ã‚Šå€¤ã«ã¯å‹ãƒ’ãƒ³ãƒˆã‚’å¿…é ˆã¨ã™ã‚‹
- **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: ãƒ‘ãƒ–ãƒªãƒƒã‚¯ãªé–¢æ•°ãƒ»ã‚¯ãƒ©ã‚¹ã«ã¯docstringã‚’è¨˜è¿°
- **å‘½åè¦å‰‡**: ã‚¹ãƒãƒ¼ã‚¯ã‚±ãƒ¼ã‚¹ï¼ˆ`snake_case`ï¼‰ã‚’ä½¿ç”¨

### 2. é–¢æ•°å®šç¾©ã®ä¾‹

```python
def calculate_sum(a: int, b: int) -> int:
    """äºŒã¤ã®æ•´æ•°ã®å’Œã‚’è¨ˆç®—ã—ã¾ã™ã€‚
    
    Args:
        a: ç¬¬ä¸€ã®æ•´æ•°
        b: ç¬¬äºŒã®æ•´æ•°
        
    Returns:
        äºŒã¤ã®æ•´æ•°ã®å’Œ
        
    Example:
        >>> calculate_sum(2, 3)
        5
    """
    return a + b
```

### 3. ç¦æ­¢äº‹é …

- `print()` æ–‡ã®ä½¿ç”¨ï¼ˆãƒ­ã‚°å‡ºåŠ›ã«ã¯ `logging` ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½¿ç”¨ï¼‰
- ãƒã‚¸ãƒƒã‚¯ãƒŠãƒ³ãƒãƒ¼ï¼ˆå®šæ•°ã¯é©åˆ‡ãªåå‰ã‚’ä»˜ã‘ã¦å®šç¾©ï¼‰
- ä¸è¦ãªå¤‰æ•°ä»£å…¥ï¼ˆ`return` ç›´å‰ã®ä»£å…¥ã¯é¿ã‘ã‚‹ï¼‰

### 4. æ¨å¥¨äº‹é …

- **æ—©æœŸãƒªã‚¿ãƒ¼ãƒ³**: ãƒã‚¹ãƒˆã‚’æµ…ãã™ã‚‹ãŸã‚
- **ãƒªã‚¹ãƒˆå†…åŒ…è¡¨è¨˜**: å˜ç´”ãªå¤‰æ›å‡¦ç†
- **å‹å®‰å…¨æ€§**: `Union` ã‚ˆã‚Š `Optional` ã‚’ä½¿ç”¨
- **ä¾‹å¤–å‡¦ç†**: å…·ä½“çš„ãªä¾‹å¤–ã‚¯ãƒ©ã‚¹ã‚’ã‚­ãƒ£ãƒƒãƒ

## ğŸ” Ruffè¨­å®šè©³ç´°

### æœ‰åŠ¹åŒ–ã•ã‚Œã¦ã„ã‚‹ãƒ«ãƒ¼ãƒ«ï¼ˆæŠœç²‹ï¼‰

| ã‚«ãƒ†ã‚´ãƒª | ãƒ«ãƒ¼ãƒ« | èª¬æ˜ |
|---------|--------|------|
| **E/W** | pycodestyle | PEP 8ã‚¹ã‚¿ã‚¤ãƒ«ã‚¬ã‚¤ãƒ‰ |
| **F** | pyflakes | æœªä½¿ç”¨importã€å¤‰æ•°ãªã© |
| **I** | isort | importæ–‡ã®ä¸¦ã³é † |
| **UP** | pyupgrade | æ–°ã—ã„æ§‹æ–‡ã®ä½¿ç”¨æ¨å¥¨ |
| **B** | bugbear | ä¸€èˆ¬çš„ãªãƒã‚°ãƒ‘ã‚¿ãƒ¼ãƒ³ |
| **C4** | comprehensions | å†…åŒ…è¡¨è¨˜ã®æœ€é©åŒ– |
| **T20** | flake8-print | `print`æ–‡ã®æ¤œå‡º |
| **PT** | pytest-style | pytestã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ |
| **RET** | flake8-return | returnæ–‡ã®æœ€é©åŒ– |
| **SIM** | simplify | ã‚³ãƒ¼ãƒ‰ç°¡ç´ åŒ–ã®ææ¡ˆ |
| **PLR** | pylint-refactor | ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ææ¡ˆ |

### é™¤å¤–ã•ã‚Œã¦ã„ã‚‹ãƒ«ãƒ¼ãƒ«

- `E501`: è¡Œé•·åˆ¶é™ï¼ˆBlackãŒå‡¦ç†ï¼‰
- `PLR0913`: å¼•æ•°æ•°åˆ¶é™ï¼ˆä¸€éƒ¨ã®ã‚±ãƒ¼ã‚¹ã§å¿…è¦ï¼‰

### ãƒ•ã‚¡ã‚¤ãƒ«åˆ¥è¨­å®š

```python
# tests/ é…ä¸‹ã§ã¯ä»¥ä¸‹ã‚’è¨±å¯
"tests/*" = ["T20", "S101"]  # printæ–‡ã€assertæ–‡
```

## ğŸ§ª ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

### 1. ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«æ§‹é€ 

```python
import pytest
from backend.main import calculate_sum, hello_world


def test_hello_world():
    """hello_worldé–¢æ•°ã®ãƒ†ã‚¹ãƒˆ"""
    assert hello_world() == "Hello, World!"


def test_calculate_sum():
    """calculate_sumé–¢æ•°ã®ãƒ†ã‚¹ãƒˆ"""
    # åŸºæœ¬çš„ãªåŠ ç®—
    assert calculate_sum(2, 3) == 5  # noqa: PLR2004
    # è² æ•°ã‚’å«ã‚€è¨ˆç®—
    assert calculate_sum(-1, 1) == 0
    # ã‚¼ãƒ­ã¨ã®è¨ˆç®—
    assert calculate_sum(0, 0) == 0
```

### 2. ãƒ†ã‚¹ãƒˆå‘½åè¦å‰‡

- ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«: `test_*.py` ã¾ãŸã¯ `*_test.py`
- ãƒ†ã‚¹ãƒˆé–¢æ•°: `test_*`
- ãƒ†ã‚¹ãƒˆã‚¯ãƒ©ã‚¹: `Test*`

### 3. ã‚«ãƒãƒ¬ãƒƒã‚¸è¦ä»¶

- **æœ€ä½ã‚«ãƒãƒ¬ãƒƒã‚¸**: 80%ä»¥ä¸Š
- **é‡è¦ãªé–¢æ•°**: 100%ã‚«ãƒãƒ¬ãƒƒã‚¸
- **é™¤å¤–å¯¾è±¡**: `if __name__ == "__main__"` ãƒ–ãƒ­ãƒƒã‚¯

### 4. ãƒ†ã‚¹ãƒˆã®ç¨®é¡

#### å˜ä½“ãƒ†ã‚¹ãƒˆ (Unit Tests)
```python
def test_pure_function():
    """ç´”ç²‹é–¢æ•°ã®ãƒ†ã‚¹ãƒˆ"""
    result = pure_function(input_value)
    assert result == expected_value
```

#### çµ±åˆãƒ†ã‚¹ãƒˆ (Integration Tests)
```python
@pytest.mark.integration
def test_database_integration():
    """ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹çµ±åˆãƒ†ã‚¹ãƒˆ"""
    # setUp, ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ, tearDown
    pass
```

#### ãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£ã®ä½¿ç”¨
```python
@pytest.fixture
def sample_data():
    """ãƒ†ã‚¹ãƒˆç”¨ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿"""
    return {"key": "value"}

def test_with_fixture(sample_data):
    """ãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£ã‚’ä½¿ç”¨ã—ãŸãƒ†ã‚¹ãƒˆ"""
    assert sample_data["key"] == "value"
```

## ğŸ”„ CI/CDçµ±åˆ

### GitHub Actions ã§ã®è‡ªå‹•å®Ÿè¡Œ

1. **ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«**: `uv pip install -e ".[dev]"`
2. **è‡ªå‹•ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ**: `black .`
3. **è‡ªå‹•ä¿®æ­£**: `ruff check --fix .`
4. **å“è³ªãƒã‚§ãƒƒã‚¯**: `black --check .` + `ruff check .`
5. **ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ**: `pytest --cov=backend`

### ã‚³ãƒŸãƒƒãƒˆæ™‚ã®è‡ªå‹•ä¿®æ­£

PRãŒä½œæˆã•ã‚Œã‚‹ã¨ã€ä»¥ä¸‹ãŒè‡ªå‹•å®Ÿè¡Œã•ã‚Œã¾ã™ï¼š

- ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®è‡ªå‹•ä¿®æ­£
- ãƒªãƒ³ãƒ†ã‚£ãƒ³ã‚°å•é¡Œã®è‡ªå‹•ä¿®æ­£
- ä¿®æ­£å†…å®¹ã®è‡ªå‹•ã‚³ãƒŸãƒƒãƒˆ

## ğŸš¨ ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºæ–¹æ³•

### 1. Import ã‚¨ãƒ©ãƒ¼

```bash
# å•é¡Œ: ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒè¦‹ã¤ã‹ã‚‰ãªã„
ModuleNotFoundError: No module named 'backend'

# è§£æ±º: editable installç¢ºèª
uv pip install -e ".[dev]"
```

### 2. Ruffè¨­å®šç«¶åˆ

```bash
# å•é¡Œ: Ruffã¨pyproject.tomlã®è¨­å®šä¸æ•´åˆ
# è§£æ±º: pyproject.tomlã®[tool.ruff]ã‚»ã‚¯ã‚·ãƒ§ãƒ³ç¢ºèª
```

### 3. ãƒ†ã‚¹ãƒˆãƒ‘ã‚¹å•é¡Œ

```bash
# å•é¡Œ: ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚‰ãªã„
# è§£æ±º: pytest.ini_optionsã®testpathsç¢ºèª
```

## ğŸ“š å‚è€ƒãƒªãƒ³ã‚¯

- [Ruff ãƒ«ãƒ¼ãƒ«ä¸€è¦§](https://docs.astral.sh/ruff/rules/)
- [Black è¨­å®šã‚ªãƒ—ã‚·ãƒ§ãƒ³](https://black.readthedocs.io/en/stable/usage_and_configuration/the_basics.html)
- [pytest ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.pytest.org/en/stable/)
- [uv ã‚¬ã‚¤ãƒ‰](https://github.com/astral-sh/uv)
- [PEP 8 ã‚¹ã‚¿ã‚¤ãƒ«ã‚¬ã‚¤ãƒ‰](https://peps.python.org/pep-0008/)

---

ğŸ’¡ **é–‹ç™ºæ™‚ã®ã‚³ãƒ„**: IDEã«Ruffã¨Blackã®æ‹¡å¼µæ©Ÿèƒ½ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã€ä¿å­˜æ™‚ã«è‡ªå‹•ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’æœ‰åŠ¹ã«ã™ã‚‹ã¨åŠ¹ç‡çš„ã§ã™ã€‚